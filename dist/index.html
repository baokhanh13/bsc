<!DOCTYPE html>
<html>
  <head>
    <title>Fortmatic Binance Smart Chain</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="/styles.8986bff4.css">
    <script src="https://cdn.jsdelivr.net/npm/fortmatic@latest/dist/fortmatic.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.3.4/dist/web3.min.js"></script>
    <script>function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

var BSCOptions = {
  /* Smart Chain Testnet RPC URL */
  rpcUrl: "https://data-seed-prebsc-1-s1.binance.org:8545/",
  chainId: 97 // Smart Chain Testnet Chain ID

};
var fm = new Fortmatic("pk_test_C26CE04AF45959D6", BSCOptions);
var web3 = new Web3(fm.getProvider());
/*  Smart contract values */

var contractABI = '[{"constant":false,"inputs":[{"name":"newMessage","type":"string"}],"name":"update","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"message","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"initMessage","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]';
var contractByteCode = "0x608060405234801561001057600080fd5b5060405161047f38038061047f8339818101604052602081101561003357600080fd5b81019080805164010000000081111561004b57600080fd5b8281019050602081018481111561006157600080fd5b815185600182028301116401000000008211171561007e57600080fd5b5050929190505050806000908051906020019061009c9291906100a3565b5050610148565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100e457805160ff1916838001178555610112565b82800160010185558215610112579182015b828111156101115782518255916020019190600101906100f6565b5b50905061011f9190610123565b5090565b61014591905b80821115610141576000816000905550600101610129565b5090565b90565b610328806101576000396000f3fe608060405234801561001057600080fd5b5060043610610053576000357c0100000000000000000000000000000000000000000000000000000000900480633d7403a314610058578063e21f37ce14610113575b600080fd5b6101116004803603602081101561006e57600080fd5b810190808035906020019064010000000081111561008b57600080fd5b82018360208201111561009d57600080fd5b803590602001918460018302840111640100000000831117156100bf57600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f820116905080830192505050505050509192919290505050610196565b005b61011b6101b0565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561015b578082015181840152602081019050610140565b50505050905090810190601f1680156101885780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b80600090805190602001906101ac92919061024e565b5050565b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156102465780601f1061021b57610100808354040283529160200191610246565b820191906000526020600020905b81548152906001019060200180831161022957829003601f168201915b505050505081565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061028f57805160ff19168380011785556102bd565b828001600101855582156102bd579182015b828111156102bc5782518255916020019190600101906102a1565b5b5090506102ca91906102ce565b5090565b6102f091905b808211156102ec5760008160009055506001016102d4565b5090565b9056fea265627a7a7230582003ae1ef5a63bf058bfd2b31398bdee39d3cbfbb7fbf84235f4bc2ec352ee810f64736f6c634300050a0032";
var contractAddress = "0x1fb4F955aEF63f5e3B8754fE32a9399864fc1b54";

var render = /*#__PURE__*/function () {
  var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {
    var isLoggedIn, authHtml, userHtml, txnHtml, signHtml, contractHtml, target, userMetadata, network, userAddress, userBalance;
    return regeneratorRuntime.wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            _context.next = 2;
            return fm.user.isLoggedIn();

          case 2:
            isLoggedIn = _context.sent;
            console.log(isLoggedIn);
            /* Show login form if user is not logged in */

            authHtml = "\n          <div class=\"container\">\n            <h1>Please sign up or login</h1>\n            <form onsubmit=\"handleLogin(event)\">\n              <button type=\"submit\">Sign Up / Login</button>\n            </form>\n          </div>\n        ";
            userHtml = "";
            txnHtml = "";
            signHtml = "";
            contractHtml = "";
            target = document.querySelector("#app");

            if (!isLoggedIn) {
              _context.next = 28;
              break;
            }

            _context.next = 13;
            return fm.user.getUser();

          case 13:
            userMetadata = _context.sent;
            _context.next = 16;
            return web3.eth.net.getNetworkType();

          case 16:
            network = _context.sent;
            _context.next = 19;
            return web3.eth.getAccounts();

          case 19:
            userAddress = _context.sent[0];
            _context.t0 = web3.utils;
            _context.next = 23;
            return web3.eth.getBalance(userAddress);

          case 23:
            _context.t1 = _context.sent;
            userBalance = _context.t0.fromWei.call(_context.t0, _context.t1);
            authHtml = "\n            <div class=\"container\">\n              <h1>Current user: ".concat(userMetadata.email, "</h1>\n              <button onclick=\"handleLogout()\">Logout</button>\n            </div>\n          ");
            userHtml = "\n            <div class=\"container\">\n              <h1>Binance Smart Chain Address</h1>\n              <div class=\"info\">\n                <a href=\"https://testnet.bscscan.com/address/".concat(userAddress, "\" target=\"_blank\">").concat(userAddress, "</a>\n              </div>\n              <h1>Network</h1>\n              <div class=\"info\">").concat(network, "</div>\n              <h1>Balance</h1>\n              <div class=\"info\">").concat(userBalance, " BNB</div>\n              <a href=\"https://testnet.binance.org/faucet-smart\" target=\"_blank\">Get Test BNB</a>\n            </div>\n          ");
            txnHtml = "\n            <div class=\"container\">\n              <h1>Send Transaction</h1>\n              <form onsubmit=\"handleSendTxn(event)\">\n                <input type=\"text\" name=\"destination\" class=\"full-width\" required=\"required\" placeholder=\"Destination address\" />\n                <input type=\"text\" name=\"amount\" class=\"full-width\" required=\"required\" placeholder=\"Amount in BNB\" />\n                <button id=\"btn-send-txn\" type=\"submit\">Send Transaction</button>\n              </form>\n            </div>\n          ";

          case 28:
            target.innerHTML = authHtml + userHtml + txnHtml;

          case 29:
          case "end":
            return _context.stop();
        }
      }
    }, _callee);
  }));

  return function render() {
    return _ref.apply(this, arguments);
  };
}();

var handleLogin = /*#__PURE__*/function () {
  var _ref2 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(e) {
    return regeneratorRuntime.wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            e.preventDefault();
            /* One-liner login ðŸ¤¯ */

            _context2.next = 3;
            return fm.user.login();

          case 3:
            render();

          case 4:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2);
  }));

  return function handleLogin(_x) {
    return _ref2.apply(this, arguments);
  };
}();

var handleSendTxn = /*#__PURE__*/function () {
  var _ref3 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3(e) {
    var destination, amount, btnSendTxn, fromAddress, receipt;
    return regeneratorRuntime.wrap(function _callee3$(_context3) {
      while (1) {
        switch (_context3.prev = _context3.next) {
          case 0:
            e.preventDefault();
            destination = new FormData(e.target).get("destination");
            amount = new FormData(e.target).get("amount");

            if (!(destination && amount)) {
              _context3.next = 15;
              break;
            }

            btnSendTxn = document.getElementById("btn-send-txn");
            btnSendTxn.disabled = true;
            btnSendTxn.innerText = "Sending...";
            _context3.next = 9;
            return web3.eth.getAccounts();

          case 9:
            fromAddress = _context3.sent[0];
            _context3.next = 12;
            return web3.eth.sendTransaction({
              from: fromAddress,
              to: destination,
              value: web3.utils.toWei(amount)
            });

          case 12:
            receipt = _context3.sent;
            console.log("Completed:", receipt);
            render();

          case 15:
          case "end":
            return _context3.stop();
        }
      }
    }, _callee3);
  }));

  return function handleSendTxn(_x2) {
    return _ref3.apply(this, arguments);
  };
}();

var handleLogout = /*#__PURE__*/function () {
  var _ref4 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4() {
    return regeneratorRuntime.wrap(function _callee4$(_context4) {
      while (1) {
        switch (_context4.prev = _context4.next) {
          case 0:
            _context4.next = 2;
            return fm.user.logout();

          case 2:
            render();

          case 3:
          case "end":
            return _context4.stop();
        }
      }
    }, _callee4);
  }));

  return function handleLogout() {
    return _ref4.apply(this, arguments);
  };
}();</script>
  <script src="/styles.8986bff4.js"></script></head>
  <body onload="render()">
    <div id="app">
      <div class="container">Loading...</div>
    </div>
  </body>
</html>
